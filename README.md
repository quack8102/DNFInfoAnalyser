# DNFInfoAnalyser
## 功能简介
DNFInfoAnalyser是一个自动分析DNF中玩家角色面板的软件。目前支持检测c（暂不支持奶）的职业（是否是协同c）、检测进图暴击是否满、显示装备和装备词条数、分析角色的力智、三攻和属强（软件会生成一个“标准”打造的相同职业、相同装备的模板角色作为对比）。

此处提到的“标准”打造与纸飞机计算器中默认打造相同（不含白金徽章）。对于实际游戏来说，这个标准太高，但目前软件处于测试阶段，选择该标准方便调试。

## 意图
作者开发此软件的意图是多元化角色的评价体系（而不仅仅是只看力智），并且消除类似于次元碟的争议。同时，恰逢希洛克版本，角色面板也会改版，团长对角色面板的正确理解显得更加重要。

## 软件使用方法
开启软件后，软件会在托盘生成一个图标，右键该图标会生成菜单。下面解释每一项菜单项。

### 窗口
会列出所有打开的DNF游戏窗口，选择其中一个窗口后，软件会与该窗口绑定并且将该窗口置顶。

### 从游戏画面分析
**要使用该功能，请窗口化DNF，并且在DNF设置中将UI大小设置为最小。同时要保证角色面板滚动条处于最上方，并且面板完整的出现在DNF窗口中。**

分析绑定的DNF游戏窗口内的人物角色面板。分析完成后会出现一个包含分析结果的窗口。

该操作的快捷键是F2（**要使用快捷键，请用管理员身份启动该程序**）。

### 关闭热键
关闭快捷键功能。

### 打开热键
关闭热键后会出现的菜单项。

打开快捷键功能。

### 从截图文件分析
**要使用该功能，请确保截图时DNF的UI大小设置为最小。同时要保证角色面板滚动条处于最上方，并且面板完整的出现在截图中。**

会出现一个文件对话框，选择截图文件后会分析截图中的人物角色面板。分析完成后会出现一个包含分析结果的窗口。

### 设置
打开设置面板。设置功能还在开发中。

### 退出
退出该软件。

## todo
添加希洛克装备

为希洛克装备增加匹配代码

适配希洛克版本新的角色面板UI

在只考虑力智、三攻、属强的情况下计算伤害变化率（与模板角色做对比）

增加设置面板

## 技术栈
qt
opencv

## 目录结构

### ./
attrcalculator 装备属性计算相关函数

character 人物属性类

csvdataparser 处理csv数据的类

cvalgorithm opencv算法相关函数

DNFInfoAnalyser.pro qt creator 工程文件

equipment 装备抽象类

factory 工厂类

main 程序入口

mainwindow 主窗口（即托盘）

userinfowindow 包含分析结果的窗口

### ./MyGlobalShortCut
第三方库，全局热键

### ./equipment
装备代码

### ./class
职业代码

### ./resources
资源文件，即贴图文件和csv文件

## 程序流程
从游戏画面截屏或者打开截图文件得到图片P，将一个角色面板上的特定图标I与P匹配，即可得到人物面板图片P1。

从P1的特定位置取数据，即可得到人物职业图片，人物装备图片，人物属性图片。

对于人物职业图片，做二值化后与资源文件匹配即可得到人物职业数据。

对于人物装备图片，与资源文件匹配即可得到人物装备数据。

对于人物属性图片，先做二值化，再做边框检测后即可把每个数字的图片提取出来，每个数字图片与资源文件匹配即可得到对应的数字，把这些数字连起来即可得到人物属性数据。

人物装备数据和人物职业数据经过工厂模式查表即可用具体的装备类和职业类对人物属性进行计算，得到“标准”打造的模板角色。